<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Søg i larm.db</title>
    <style>
        body {
            font-family: "Segoe UI", Roboto, sans-serif;
            background: #f7f8fa;
            color: #222;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
        }

        h1 {
            font-size: 2rem;
            color: #333;
        }

        form {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 28px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            width: 320px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        form:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        label {
            font-weight: 500;
            margin-top: 0.5rem;
        }

        input[type="number"],
        input[type="date"] {
            padding: 0.6rem;
            border: 1px solid #ccc;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s ease;
            width: 90%;
            box-sizing: border-box;
        }

        input[type="number"]:focus,
        input[type="date"]:focus {
            border-color: #0078d7;
        }

        input[type="submit"] {
            margin-top: 1rem;
            background: #0078d7;
            color: white;
            border: none;
            border-radius: 18px;
            padding: 0.7rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        input[type="submit"]:hover {
            background: #005fa3;
        }

        details {
            background: #e5e5e5;
            padding: 0.8rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        details:hover {
            background: #dcdcdc;
        }

        summary {
            font-weight: 600;
            color: #333;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            user-select: none;
        }

        summary::before {
            content: "▶";
            font-size: 0.9rem;
            transition: transform 0.2s ease;
        }

        details[open] summary::before {
            transform: rotate(90deg);
        }

        summary::-webkit-details-marker {
            display: none;
        }

        details[open] summary {
            margin-bottom: 0.5rem;
        }

        details > label,
        details > input {
            width: 90%;
            margin-left: 0.8rem;
        }

        details > label {
            margin-top: 0.4rem;
            display: block;
        }

        /* Indholdsfortegnelse */
        .toc {
            background: #f0f2f5;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            width: 360px;
            font-size: 0.95rem;
        }

        .toc h2 {
            font-size: 1.1rem;
            color: #005fa3;
            margin-bottom: 0.5rem;
        }

        .toc ul {
            list-style-type: disc;
            margin: 0;
            padding-left: 1.5rem;
        }

        .rankings {
            background: #fff;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            width: 360px;
        }

        .rankings h2 {
            margin-top: 0;
            color: #005fa3;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .rankings ul {
            padding-left: 1.2rem;
        }

    </style>
</head>
<body>
<h1>Søg data</h1>

<!-- Guide -->
<div class="toc">
    <h2>Guide til hjemmesiden</h2>
    <ul>
        <p>Denne hjemmeside er skabt for at få et overblik over støjniveau. Der er et link nederst, hvor du kan læse mere.</p>
        <li>Alt data:</li>
            <p>Du kan hente alt data fra alle sensor fra starten, eller indenfor en periode. Det kan du i Alt data boksen.</p>
        <li>Lokale data:</li>
            <p>Du kan hente alt data fra et lokale fra starten, eller indenfor en periode. Det kan du i Lokale data boksen.</p>
        <li>Sensor data:</li>
            <p>Du kan hente alt data fra en specifik sensor fra starten, eller indenfor en periode. Det kan du i Sensor data boksen.</p>
    </ul>
</div>

<!-- Formularer -->
<h2>Alt data</h2>
<form action="/" method="post">
    <details>
        <summary>Vælg tidsrum (valgfrit)</summary>
        <label for="start_all">Start tid:</label>
        <input type="date" id="start_all" name="start">
        <label for="end_all">Slut tid:</label>
        <input type="date" id="end_all" name="end">
    </details>
    <input type="hidden" name="all" value="1">
    <input type="submit" value="Hent alt data">
</form>

<h2>Lokale data</h2>
<form action="/" method="post">
    <details open>
        <summary>Lokaler</summary>
        {% for lokale in lokaler %}
            <input type="submit" value="{{ lokale }}" name="lokale">
        {% endfor %}
    </details>

    <details>
        <summary>Vælg tidsrum (valgfrit)</summary>
        <label for="start_lokale">Start tid:</label>
        <input type="date" id="start_lokale" name="start">
        <label for="end_lokale">Slut tid:</label>
        <input type="date" id="end_lokale" name="end">
    </details>
</form>

<h2>Sensor data</h2>
<form action="/" method="post">
    <details open>
        <summary>Sensorer</summary>
        {% for sensor in sensorer %}
            <input type="submit" value="{{ sensor }}" name="lokale">
        {% endfor %}
    </details>

    <details>
        <summary>Vælg tidsrum (valgfrit)</summary>
        <label for="start_sensor">Start tid:</label>
        <input type="date" id="start_sensor" name="start">
        <label for="end_sensor">Slut tid:</label>
        <input type="date" id="end_sensor" name="end">
    </details>
</form>

<!-- Ranking-boks -->
<div class="rankings">
    <h2>Top støjende sensorer (seneste måling)</h2>
    <ul id="ranking-list">
        <li>Henter data...</li>
    </ul>
</div>

<p>Skabt med kærlighed for høresansen af Abdullah, Adam og Lukas.
    <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Læs mere her.</a></p>

<script>
async function fetchRankings() {
    try {
        const response = await fetch('/rankings');
        const data = await response.json();
        const list = document.getElementById('ranking-list');
        list.innerHTML = ''; // Clear previous list

        if(data.length === 0){
            const li = document.createElement('li');
            li.textContent = 'Ingen data tilgængelig';
            list.appendChild(li);
            return;
        }

        data.forEach((item) => {
            const li = document.createElement('li');
            li.textContent = `Sensor ${item.sensor_id} - Lokale ${item.lokale}: ${item.db} dB`;
            list.appendChild(li);
        });
    } catch (error) {
        console.error('Fejl ved hentning af rankings:', error);
    }
}

// Hent rankings første gang og hver 10. sekund
fetchRankings();
setInterval(fetchRankings, 10000);
</script>
</body>
</html>
